<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.537">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Zion Gassner">
<meta name="dcterms.date" content="2024-02-07">

<title>Zion’s Extraordinary Python Adventure - Making Discord, Well, Sort of…</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Zion’s Extraordinary Python Adventure</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About Zion’s Blog</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Making Discord, Well, Sort of…</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">week 5</div>
                <div class="quarto-category">homework 3</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Zion Gassner </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 7, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="introduction" class="level1">
<h1>Introduction</h1>
<p>Up until now, we’ve been creating programs that we run locally on our system, but often times when we interact with something on a computer, we do so thanks to something that someone else has made that we’ve acquired through the internet. Now, by making a website using HTML and CSS, we’ll do the same (in theory, anyway, since we won’t be publicly hosting our website, but you could if you wanted to). We’ll also put our code onto a GitHub repository so that anyone can play with it freely.</p>
<p>In this post, I’m going to create a simple website that gives the user the opportunity to send messages under a certain name or handle and will then be able to view such messages in a different page. The skeleton of the website will be designed via HTML templates, but we’ll be using a framework called Flask which allows us to write Python code specifically for our website, allowing us to incorporate more advanced techniques, including a SQL database which will contain users’ stored messages. Finally, we’ll also dabble a bit into CSS, which we can use to customize the look of our website, making it look like the popular messaging app Discord.</p>
<section id="github-repository" class="level2">
<h2 class="anchored" data-anchor-id="github-repository">GitHub Repository</h2>
<p>While I provide a tutorial to create everything from scratch, you are free to download my files for the project and experiment with them however you like:</p>
<p>https://github.com/torwar02/hw3</p>
<p>Everything necessary is in the primary folder called <code>flask-project</code></p>
</section>
</section>
<section id="getting-started-with-flask" class="level1">
<h1>Getting Started with Flask</h1>
<p>Flask is a web development <em>framework</em> that we can use with Python as a programming language. As it is therefore somewhat external, we need to make sure to set it up correctly. The following link provides an excellent tutorial on how to get started. My examples are demonstrated on a Mac using Anaconda.</p>
<p>https://python-adv-web-apps.readthedocs.io/en/latest/flask.html</p>
<p>Essentially, there are two very important parts regarding the set-up. Firstly, if it’s your first time, you’re going to have to activate a virtual environment for Flask. Secondly, you’re going to have to use the command line to generate Flask projects.</p>
<p>Because of the environment provided by Professor Ko for PIC 16B, I was able to skip these steps, but you should see the section titled “Setup For Flask” at the link above. You need to create a directory for your Flask projects, create and activate the virtual directory, and lastly, install the Flask package for Python (otherwise you wouldn’t be able to get your files to interact with it!). The above link suggests using <code>pip</code> to install–please make sure that this is valid on your system as this is not recommended with Anaconda.</p>
<section id="creating-a-flask-project" class="level2">
<h2 class="anchored" data-anchor-id="creating-a-flask-project">Creating a Flask Project</h2>
<p>Once you have Flask installed, it’s time to actually create a project. We first need to set something up ourselves–make a folder, and give it an appropriate name (mine is simply called <code>flask-project</code> as it is unambiguous inside of my blog files), and using a text editor of your choice, create a new Python file, also giving it a sensible name (<code>app.py</code>). Then, in your command line, change the current directory to your project folder (using</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and the appropriate folder name) and run the following command:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">FLASK_APP</span><span class="op">=</span>app.py</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This lets Flask know that <code>app.py</code> is the sort of ‘master file’ that your web app is going to be based on. Otherwise, it wouldn’t know what to do! But we can’t actually run our website yet as we need to set up a few things in our file before we can even view anything. Inside of <code>app.py</code>, you should have the following:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sqlite3</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> flask <span class="im">import</span> Flask, g, render_template, request</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> flask <span class="im">import</span> redirect, url_for</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>app <span class="op">=</span> Flask(<span class="va">__name__</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>import</code> statements are nothing crazy, although it’s important to note that there are a lot of things that we have to retrieve from Flask itself, including <code>Flask</code>, which is necessary for making our website run, and <code>render_template</code>, without which we would not be able to view HTML files!</p>
<p>Finally, the line <code>app = Flask(__name__)</code> is what actually creates the file into something that Flask can interact with. This is essentially the skeleton of the website.</p>
<p>At this point, we can actually get our website to work with the command</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">flask</span> run</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Though we won’t see our website because we haven’t put anything on it yet.</p>
</section>
<section id="project-overview" class="level2">
<h2 class="anchored" data-anchor-id="project-overview">Project Overview</h2>
<p>From this point on, this post will be divided into sections that correspond to different parts of our website that we need to put together, but before we can do that, we need to have an understanding of what we’re going to do.</p>
<section id="submission" class="level3">
<h3 class="anchored" data-anchor-id="submission">Submission</h3>
<p>Our website needs to have a page for the user to submit messages based on a handle of their choice. Below is a screenshot provided from the PIC 16B blog as an example:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Image1.png" class="img-fluid figure-img"></p>
<figcaption>image.png</figcaption>
</figure>
</div>
</section>
<section id="database-creation" class="level3">
<h3 class="anchored" data-anchor-id="database-creation">Database Creation</h3>
<p>We’re going to eventually want the user to be able to view past messages, but to do so, we’re going to have to store existing ones somehow. We will do this by creating a function within <code>app.py</code> that allows us to create and manipulate a SQL database (which is why earlier we imported <code>sqlite3</code>), which will later be retrieved by the website.</p>
</section>
<section id="message-viewing" class="level3">
<h3 class="anchored" data-anchor-id="message-viewing">Message Viewing</h3>
<p>Finally, we’re going to want to create an additional page so that users can look at previous messages that have been set. Per the specifications of this assignment, we’re going to want to display five randomly chosen messages out of the existing bank. We’ll have to make not only a new HTML page but also a function that allows us to retrieve the messages from the database.</p>
<p>With that overview out of the way, let’s get started!</p>
</section>
</section>
</section>
<section id="index-pagesubmit" class="level1">
<h1>Index Page/Submit</h1>
<p>To specify a certain root on a website, we generally put slashes <code>/</code> after the url to indicate subpages. (For example, <code>bruinlearn.ucla.edu/courses/[course number</code> takes you to a Canvas page of a specific class). Thus, for the message submission page, I am going to want to add <code>/submit</code>. Note that when we host the website locally, we will always be viewing it with the “URL” <code>localhost:5000</code> or <code>http://127.0.0.1:5000/</code>, which are only accessible from one’s own system.</p>
<p>With how I’m making the website, I really only want the user to interact with the message submission/viewing process, so the first thing that I’m going to do is to cause the page to <strong>redirect the user</strong> to the submission page. So, the first thing we’ll do is specify what happens when the user goes to the ‘raw’ (called ‘index’) URL and then what should appear (preliminarily) on the <code>/submit/</code> page:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">"/"</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> redirect_page():</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> redirect(url_for(<span class="st">"submit"</span>))</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">"/submit/"</span>, methods<span class="op">=</span>[<span class="st">'POST'</span>, <span class="st">'GET'</span>]) </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> submit():</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This seems a bit overwhelming. Let’s break it down. The <code>@</code> operator in Python is called a <strong>decorator</strong> and is used to modify a function in the next line. We always modify the <code>route</code> method of <code>app</code> (which we made above), and the argument that we pass into <code>route</code> is a string containing the subdirectory on our page. For the ‘initial’ page we put just a slash. Below, we set it up for <code>/submit/</code>.</p>
<p>Then we define the Python function corresponding to our website. We can name it anything we want (it doesn’t <em>necessarily</em> have to be the same as the string in the decorator), but just make sure it’s a name that makes sense, becuase we’ll need to reference it. The <strong>body</strong> of the function should contain the Python code that we want to run for the website. On the first page, we use the function <code>redirect</code> to take us to <code>/submit/</code>. Notice that we use <code>url_for</code> and call this on the string <code>"submit"</code> which corresponds to the name of the function below.</p>
<p>In the next decorator, we also have an arugment called <code>methods</code> which contains a list <code>['POST', 'GET']</code>. Don’t worry about this for now–this will come in handy when we need to make changes to the webpage. For now, we have nothing. If we generate the website via</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">run</span> flask</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>and navigate to <code>http://127.0.0.1:5000/</code> or <code>localhost:5000</code></p>
<p>we’ll see a blank page with the subdirectory <code>submit</code>.</p>
<section id="body-of-submit" class="level2">
<h2 class="anchored" data-anchor-id="body-of-submit">Body of <code>/submit/</code></h2>
<p>The following code <strong>won’t work</strong> because I show a function that we haven’t implemented yet (but will soon):</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">"/submit/"</span>, methods<span class="op">=</span>[<span class="st">'POST'</span>, <span class="st">'GET'</span>])</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> submit():</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> request.method <span class="op">==</span> <span class="st">'GET'</span>:</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> render_template(<span class="st">'submit.html'</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>        insert_message(request)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> render_template(<span class="st">'submit.html'</span>, sec <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can think of <code>request</code> as the current page (remember Webscraping?) and the method as as the “state” of the website. <code>GET</code> is the state of the page when we arrive on the page. <code>render_template</code> is what allows us to take another HTML file and display it on the page, so we’re going to have to make a <strong>template</strong> called <code>submit.html</code>. If the method is <code>post</code>, we’re going to call a function called <code>insert_message</code> that will allow us to put messages on the message board, so we need to write that function as well. There’s a lot that we have to do to make it work! Let’s start with the Python functions, because otherwise we won’t be able to even display anything on our site.</p>
</section>
<section id="get_message_db" class="level2">
<h2 class="anchored" data-anchor-id="get_message_db">get_message_db()</h2>
<p>The function <code>insert_message</code> will place a message onto the current instance (<code>request</code>) of the website, via a SQL database, so first we need to make a function that simultaneously creates accesses the database (recall from the Week 1 post that <code>.connect</code> in <code>sqlite3</code> can do both). To do this, we’ll make a function called <code>get_message_db()</code>.</p>
<p>Here’s the function:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_message_db(): <span class="co">#create/access database</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span>:</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> g.message_db <span class="co">#gets datbase from `g` object</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">except</span>: <span class="co">#should only go through here once</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        g.message_db <span class="op">=</span> sqlite3.<span class="ex">connect</span>(<span class="st">"messages_db.sqlite"</span>) <span class="co">#makes database</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        cursor <span class="op">=</span> g.message_db.cursor()</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>        cmd <span class="op">=</span> <span class="st">"""</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="st">        CREATE TABLE IF NOT EXISTS messages(</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="st">        handle TEXT,</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="st">        message TEXT</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="st">        );</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="st">        """</span> <span class="co">#creates table</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>        cursor.execute(cmd)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>        cursor.close()</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> g.message_db <span class="co">#then returns datbaase</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We do this with <code>try</code> and <code>except</code> statements because we would get an error if the database doesn’t exist. Most of this should be review from the Week 1 post, including the use of <code>sqlite3.connect</code> to make and then connect to a database, which we call <code>messages_db</code>. Our SQL query creates a table called <code>messages</code> using the <code>CREATE TABLE IF NOT EXISTS</code> command. We specify the name of each column (<code>handle</code> and <code>message</code>) as well as the data type (<code>TEXT</code>). We execute the command, close the cursor, and send back the database.</p>
<p>The only thing here that’s completely new is <code>g</code>, which is an attribute of <code>app</code>, that is, the file itself which comes with Flask. I am not well-versed enough in Flask to give an excellent explanation, but see this StackOverflow post for more info:</p>
<p>https://stackoverflow.com/questions/30514749/what-is-the-g-object-in-this-flask-code</p>
<p>Essentially, it’s a sort of global object in which we can store whatever we want while the app is running. This is important since it sort of lets us make <strong>global variables</strong> for any of the functions we create, which is why we decide to make our database equivalent to an attribute of <code>g</code> called <code>message_db</code>. Just note that this didn’t work (at least for me) until I imported <code>g</code> from Flask (which I had you do at the beginning).</p>
</section>
<section id="insert_message" class="level2">
<h2 class="anchored" data-anchor-id="insert_message">insert_message()</h2>
<p>This function is a bit hard to explain without the HTML template for <code>/submit</code>, but let’s walk through it:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert_message(request): <span class="co">#places messages into database</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    handle <span class="op">=</span> request.form[<span class="st">'handle'</span>] <span class="co">#extracts `handle`/`message` from form</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    message <span class="op">=</span> request.form[<span class="st">'message'</span>]</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    db <span class="op">=</span> get_message_db()</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    info <span class="op">=</span> pd.DataFrame([{<span class="st">'handle'</span>: handle, <span class="st">'message'</span> : message}]) <span class="co">#places handle/message into df</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    info.to_sql(<span class="st">"messages"</span>, db, if_exists <span class="op">=</span> <span class="st">"append"</span>, index <span class="op">=</span> <span class="va">False</span>) <span class="co">#places into db</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    db.commit()</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    db.close()</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> handle, message <span class="co">#sends back `handle` and `message` to `submit()`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>I’ll explain this later, but keep in mind that this function is called inside of the <code>submit()</code> function, so we should be thinking that we’re on the submission page. We’ll be grabbing user-inputted variables called <code>message</code> and <code>handle</code> (which will be part of the HTML code) and store them in the function. We then connect to the database using <code>get_message_db()</code>, create a one-row data frame called <code>info</code> containing the handle and the message, and append it onto the <code>messages</code> table in the database (once again, review Homework 1 post for details on the <code>to_sql</code> method from Pandas). Then, we commit the changes, lose the connection, and send back the handle and messages.</p>
</section>
</section>
<section id="html-templates" class="level1">
<h1>HTML Templates</h1>
<p>Okay, so what are we actually going to show on the website? This is where templates come in handy. In the same folder that contains <code>app.py</code>, make a new folder called <code>templates</code>, and using a text editor, create two files: one called <code>base.html</code>, and another called <code>submit.html</code>. I’ve already referred to the latter, but <code>base.html</code> will work as a base that we modify on other pages.</p>
<section id="base.html" class="level2">
<h2 class="anchored" data-anchor-id="base.html">base.html</h2>
<p>The first thing that I wanted to remind you of is the fact that I wanted to make the webpage look like Discord, specifically, a Discord server used by UCLA students, which is why there’s referenced to this throughout the page:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;!doctype</span> html<span class="dt">&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">link</span><span class="ot"> rel</span><span class="op">=</span><span class="st">"stylesheet"</span><span class="ot"> href</span><span class="op">=</span><span class="st">"{{ url_for('static', filename='style.css') }}"</span><span class="dt">&gt;</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">title</span><span class="dt">&gt;</span>{% block title %}{% endblock %} Fake Discord<span class="dt">&lt;/</span><span class="kw">title</span><span class="dt">&gt;</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">nav</span><span class="dt">&gt;</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">h1</span><span class="dt">&gt;</span>Welcome to UCLA Students and Friends! <span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>        Please see #rules-and-info to get started.</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;/</span><span class="kw">h1</span><span class="dt">&gt;</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">ul</span><span class="dt">&gt;</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;&lt;</span><span class="kw">a</span><span class="ot"> href</span><span class="op">=</span><span class="st">"{{ url_for('submit') }}"</span><span class="dt">&gt;</span>Post Messages<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">li</span><span class="dt">&gt;&lt;</span><span class="kw">a</span><span class="ot"> href</span><span class="op">=</span><span class="st">"{{ url_for('view') }}"</span><span class="dt">&gt;</span>View Messages<span class="dt">&lt;/</span><span class="kw">a</span><span class="dt">&gt;&lt;/</span><span class="kw">li</span><span class="dt">&gt;</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">ul</span><span class="dt">&gt;</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">nav</span><span class="dt">&gt;</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">img</span><span class="ot"> src </span><span class="op">=</span> <span class="st">"https://cdn.discordapp.com/attachments/1186502778600820746/1204873997150453860/ChannelsSidebar.png?ex=65d6515a</span><span class="er">&amp;</span><span class="st">is=65c3dc5a</span><span class="er">&amp;</span><span class="st">hm=b906d75f0192467f2062c75eb343ba78f629fd8593afa5c781f067bc947f5514</span><span class="er">&amp;</span><span class="st">"</span><span class="ot"> height </span><span class="op">=</span> <span class="st">"800"</span><span class="ot"> width </span><span class="op">=</span> <span class="st">"250"</span><span class="ot"> style</span><span class="op">=</span><span class="st">"position:fixed; top:0px;  left:0px"</span><span class="dt">&gt;</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">img</span><span class="ot"> src </span><span class="op">=</span> <span class="st">"https://cdn.discordapp.com/attachments/1186502778600820746/1204873997460971582/UsersSiderbar.png?ex=65d6515a</span><span class="er">&amp;</span><span class="st">is=65c3dc5a</span><span class="er">&amp;</span><span class="st">hm=f1282537c4f4f000be28a42e583e212f1763294cfde93973c80297b84824a535</span><span class="er">&amp;</span><span class="st">"</span><span class="ot"> height </span><span class="op">=</span> <span class="st">"800"</span><span class="ot"> width </span><span class="op">=</span> <span class="st">"250"</span><span class="ot"> style</span><span class="op">=</span><span class="st">"position:fixed; top:0px;  right:0px"</span><span class="dt">&gt;</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">section</span><span class="ot"> class</span><span class="op">=</span><span class="st">"content"</span><span class="dt">&gt;</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">header</span><span class="dt">&gt;</span></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>    {% block header %}{% endblock %}</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">header</span><span class="dt">&gt;</span></span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>  {% block content %}{% endblock %}</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;/</span><span class="kw">section</span><span class="dt">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>There’s a lot going on here, and I used the header from a Flask demo that our professor prepared for us as a template while adding my own contributions. We’ll walk through the major parts, but note that I don’t know a lot of the fine details regarding HTML–it’s important to keep in mind that by working with Python, Flask, CSS, and HTML, we’re using many different tools, and it’s unrealistic to be able to master all of them in a short period of time. I have referred to documentation when I was stuck, and I encourage you to do the same.</p>
<p>Firstly we write <code>&lt;!doctype html&gt;</code> to signal that this is an HTML document. The second statement connects it to the file that we’ll look at later which incorporates our CSS settings.</p>
<section id="title-and-nav" class="level3">
<h3 class="anchored" data-anchor-id="title-and-nav"><code>&lt;title&gt;</code> and <code>&lt;nav&gt;</code></h3>
<p>First we start with a title. This refers to the text that appears on the tab of your web browser. Note that the content of each tag is demarcated by <code>&lt;tag&gt;</code> and <code>&lt;/tag&gt;.</code> A <code>&lt;nav&gt;</code> tag contains links to other parts of the page–we make this so that we can link the submission and viewing pages. First, we put some title text in <code>&lt;h1&gt;</code>, which stands for “heading 1” (bigger text, you’ve seen it on this blog!). Then, we make a <code>&lt;ul&gt;</code> or unordered list that has our links. Each element of a list is an <code>li</code>, and in each <code>li</code> we put the link to our other pages. This should look familiar from the webscraping tutorial–links are <code>&lt;a&gt;</code>. The only thing that’s new for us is the link itself, which is <code>"{{ url_for('submit') }}"</code>–we saw this earlier when using <code>redirect</code>–which refers to the URL governed by the <code>submit</code> function. We do the same for <code>view</code>. Then, we close out the list and navegation.</p>
</section>
<section id="img" class="level3">
<h3 class="anchored" data-anchor-id="img"><code>&lt;img&gt;</code></h3>
<p>Now, I want to place images on either side to pretend that we’re on Discord. I took screenshots from a Discord server and uploaded them onto Discord itself since I frequently use it to store image links. I couldn’t get this to work by storing the images locally, otherwise I would have. Each <code>&lt;img&gt;</code> is made of various attributes: <code>src</code> tells us where to get it from (in our case, a URL), whereas <code>height</code> and <code>width</code> control the dimensions. <code>style</code> can be used to control where the image is placed on the page. I want them to look like sidebars, so I set the position to <code>fixed</code> and specify how many pixels from the page’s top, left, or right I want the image. This site was very helpful:</p>
<p>https://www.w3schools.com/html/html_images.asp</p>
</section>
<section id="section" class="level3">
<h3 class="anchored" data-anchor-id="section"><code>&lt;section&gt;</code></h3>
<p>We use this tag to create concrete sections of a document. For <code>base.html</code>, there really shouldn’t be much here, since all we want to be constant is the navigation and images. Note that we can give it a class type of <code>content</code> , and inside, we use syntax from Jinja, which helps us code certain Python functionalities into HTML pages: we enclose these statements with a curly brace and percent sign, and inside, we put instructions. Here we create <code>header</code> and <code>content</code> blocks. In this case, they’re just markers–when we reference <code>base.html</code> in our other templates, we can specify what we want to put in here. <code>base.html</code> just provides a framework.</p>
</section>
</section>
<section id="submit.html" class="level2">
<h2 class="anchored" data-anchor-id="submit.html"><code>submit.html</code></h2>
<p>With <code>base.html</code> out of the way, let’s look at what we really wanted to see–the layout of the <code>submit</code> page. It’s actually simpler than you might think, thanks to the fact that <code>submit()</code> in <code>app.py</code> does a lot of the hard work:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>{% extends 'base.html' %}</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>{% block content %}</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">img</span><span class="ot"> src </span><span class="op">=</span><span class="st">"https://cdn.discordapp.com/attachments/360940494240350209/1204479028057215056/discordchatting.png?ex=65d4e182</span><span class="er">&amp;</span><span class="st">is=65c26c82</span><span class="er">&amp;</span><span class="st">hm=922db462e88ad85c31db7b07af6a11855da471687480209a70b96cf82fd57720</span><span class="er">&amp;</span><span class="st">"</span><span class="dt">&gt;</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">form</span><span class="ot"> method</span><span class="op">=</span><span class="st">"post"</span><span class="dt">&gt;</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">label</span><span class="ot"> for</span><span class="op">=</span><span class="st">"handle"</span><span class="dt">&gt;</span>What's your handle?<span class="dt">&lt;/</span><span class="kw">label</span><span class="dt">&gt;</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> name</span><span class="op">=</span><span class="st">"handle"</span><span class="ot"> id</span><span class="op">=</span><span class="st">"handle"</span><span class="dt">&gt;</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">label</span><span class="ot"> for</span><span class="op">=</span><span class="st">"message"</span><span class="dt">&gt;</span>Message #general...<span class="dt">&lt;/</span><span class="kw">label</span><span class="dt">&gt;</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> type </span><span class="op">=</span> <span class="st">"text"</span><span class="ot"> name</span><span class="op">=</span><span class="st">"message"</span><span class="ot"> id</span><span class="op">=</span><span class="st">"message"</span><span class="dt">&gt;</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">input</span><span class="ot"> type</span><span class="op">=</span><span class="st">"submit"</span><span class="ot"> value</span><span class="op">=</span><span class="st">"Send Message"</span><span class="dt">&gt;</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;/</span><span class="kw">form</span><span class="dt">&gt;</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  {% if sec == True %}</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>      <span class="dt">&lt;</span><span class="kw">b</span><span class="dt">&gt;</span>Message sent<span class="dt">&lt;/</span><span class="kw">b</span><span class="dt">&gt;</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  {% endif %}</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>{% endblock %}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="jinja-syntax" class="level2">
<h2 class="anchored" data-anchor-id="jinja-syntax">Jinja syntax</h2>
<p>The first thing we do is to extend <code>base.html</code>–that is, to essentially place this template’s code within that file. We then specify what we want in the <code>content</code> block which we left empty in <code>base.html</code>.</p>
<p>The first thing we do is place an image that simulates a chat in a Disord channel, which we’ve talked about already. Then, however, we input a <code>form</code> with method <code>post</code></p>
</section>
<section id="form-and-submit" class="level2">
<h2 class="anchored" data-anchor-id="form-and-submit"><code>&lt;form&gt;</code> and <code>submit()</code></h2>
<p>This is where it’s crucial to understand how <code>submit.html</code> interacts with <code>app.py</code>. Essentially, we want to create a tag of type <code>&lt;form&gt;</code> which allows for user input on the site. We specify that it has a method called <code>post</code>–the same <code>post</code> as we saw in the arguments of <code>submit()</code>. The method on the page when we first arrive is <code>get</code> (not listed), but it will be updated to <code>post</code> once the user interacts with the text box, We create labels for the two text boxes (<code>&lt;label&gt;</code>) which we specify are for two variables called <code>handle</code> and <code>message</code>–the two things we wanted to place in <code>messages_db.sqlite</code>. We then create two different tags of type <code>&lt;input&gt;</code> which are the text boxes for the above variables, and finally, a submission button which we get as specifying the type for <code>&lt;input&gt;</code> as <code>submit</code>. Then, we end the form.</p>
<section id="render_template" class="level3">
<h3 class="anchored" data-anchor-id="render_template"><code>render_template()</code></h3>
<p>Back in the body for <code>submit()</code> in <code>app.py</code>, we see that we call the function <code>render_template()</code> on <code>submit.html</code>. This causes the template we’ve made above to be displayed and prompts the user for input, setting the method to <code>post</code>. Notice that this submission triggers the body of the <code>else</code> part of the conditional statement, which calls <code>insert_message()</code> on <code>request</code> (recall that <code>request</code> refers to what’s available on the current page). Recall that <code>insert_message()</code> starts as such:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> insert_message(request):</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    message <span class="op">=</span> request.form[<span class="st">'message'</span>]</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    handle <span class="op">=</span> request.form[<span class="st">'handle'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In other words, we grab the <code>message</code> and <code>handle</code> variables from the <code>form</code> of <code>submit.html</code>. This is how we are able to get Python to interact with the website through Flask in order to store the messages!</p>
<p>At the end of the <code>else</code> statement, we render the page once again but with <code>sec</code> set to <code>True</code>. We are allowed to input parameters into our function so long as they correspond with Jinja syntax. Returning to <code>submit.html</code>, we see that we have a statement <code>{% if sec == True %}</code>, which corresponds to such a variable. When the condition is satisfied, we create a line break <code>&lt;br&gt;</code> and display a message saying <code>Message sent</code>, after which we close the conditional statement and the block in general. Here’s what the website looks like when the user is submitting a message!</p>
<p>This image shows a user typing a message into the message form:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Image3.webp" class="img-fluid figure-img"></p>
<figcaption>Image 3</figcaption>
</figure>
</div>
<p>This one shows the submission message:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Image4.png" class="img-fluid figure-img"></p>
<figcaption>Image 4</figcaption>
</figure>
</div>
</section>
</section>
</section>
<section id="view" class="level1">
<h1><code>View</code></h1>
<p>With the <code>submit</code> page completed, it’s time for us to be able to view our messages. Our overall goal here is to grab 5 random messages from <code>messages_db.sqlite</code> that we’ve inserted using <code>insert_messages()</code>. Let’s go over this first.</p>
<section id="random_messages" class="level2">
<h2 class="anchored" data-anchor-id="random_messages"><code>random_messages()</code></h2>
<p>All we essentially need from this function is to return 5 rows from the database in a way that can be read by Python. Look at the following code:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> random_messages(n):</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    db <span class="op">=</span> get_message_db()</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    cmd <span class="op">=</span> <span class="ss">f""" SELECT * FROM messages ORDER BY RANDOM() LIMIT </span><span class="sc">{</span>n<span class="sc">}</span><span class="ss">; """</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    postings <span class="op">=</span> pd.read_sql_query(cmd, db)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    db.close()</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> postings</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In general, we allow for any number of random messages, though I specify 5 in <code>view.html</code> (thus, this can be changed by the user), hence the SQL query we execute will be in the form of an <code>f</code> string. Thanks to the following StackOverflow post provided by Professor Ko, we’re able to easily write the query:</p>
<p>https://stackoverflow.com/questions/2279706/select-random-row-from-a-sqlite-table</p>
<p>Essentially, <code>*</code> refers to selecting everything, <code>ORDER BY</code> sorts the table, and we do so with a function in SQL called <code>RANDOM()</code>. Finally, <code>LIMIT</code> specifies the number of rows we want back hence, <code>n</code>.</p>
<p>We then use the <code>read_sql_query</code> command from <code>pandas</code> alongside the database connection created by using <code>get_message_db</code>, we close the connection, and then we return the rows that we get back. Recall from the post on `sqlite that this will be in the form of a data frame.</p>
</section>
<section id="view-1" class="level2">
<h2 class="anchored" data-anchor-id="view-1"><code>view()</code></h2>
<p>Now that we have a function that can fetch items from the database, we’re going to need a function responsible for viewing our page, which we call <code>view</code> in <code>app.py</code>. As we did with <code>submit()</code>, we will need to return a <code>render_template()</code> statement in order to make the changes meaningful on the page. Here’s the code:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="at">@app.route</span>(<span class="st">"/view/"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> view(): <span class="co">#For viewing messages</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    postings <span class="op">=</span> random_messages(<span class="dv">5</span>) <span class="co">#Get 5 random messages from database</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    length <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    message_tuples <span class="op">=</span> []</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(length):</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>        message_tuples.append(<span class="bu">tuple</span>(postings.iloc[i,:])) <span class="co">#Convert df rows into tuples</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> render_template(<span class="st">'view.html'</span>, message_tuples <span class="op">=</span> message_tuples) <span class="co">#display `view`</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Firstly, we call the <code>random_messages()</code> function with <code>n = 5</code>, and then, we create a list that will contain tuples from the <code>postings</code> data frame, which will make it easier to interface with Jinja in <code>view.html</code>. Using a <code>for</code> loop, we add the <code>handle</code> and <code>message</code> as a tuple into the list by using the <code>.iloc</code> method to fetch what’s in each row.</p>
<p>Then, we return <code>render_template</code> on <code>view.html</code> with an argument called <code>message_tuples</code> set equal to, well, <code>message_tuples</code>, which will be a variable that we place inside of the Jinja syntax.</p>
</section>
<section id="view.html" class="level2">
<h2 class="anchored" data-anchor-id="view.html"><code>view.html</code></h2>
<p>Just like with <code>submit.html</code>, this part is quite simple:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode html code-with-copy"><code class="sourceCode html"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>{% extends 'base.html' %}</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>{% block header %}</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">&lt;</span><span class="kw">h1</span><span class="dt">&gt;</span>{% block title %}#general{% endblock %}<span class="dt">&lt;/</span><span class="kw">h1</span><span class="dt">&gt;</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>{% endblock %}</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>{% block content %}</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>{% for tuple in message_tuples%}</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">&lt;</span><span class="kw">h4</span><span class="dt">&gt;</span>{{tuple[0]}}<span class="dt">&lt;/</span><span class="kw">h4</span><span class="dt">&gt;</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a> <span class="dt">&lt;</span><span class="kw">p</span><span class="dt">&gt;</span>{{tuple[1]}}<span class="dt">&lt;/</span><span class="kw">p</span><span class="dt">&gt;</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="dt">&lt;</span><span class="kw">br</span><span class="dt">&gt;</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>{% endfor %}</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>{% endblock %}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We once again extend <code>base.html</code> to add onto what we already have. In the <code>header</code> block, we place a title with the text <code>#general</code> (as is common on Discord servers).</p>
<p>Then in the <code>content</code> block, we create a <code>for</code> loop in Jinja in order to print out precisely the messages that we had placed as tuples in <code>message_tuples</code> in <code>view()</code> from <code>app.py</code>. This loop first prints out the handle (which is the element at the 0th index) as an <code>&lt;h4&gt;</code> (header 4) while the actual message is simply kept as a paragraph (~normal text) <code>&lt;p&gt;</code>. This has the effect of highlighting the name in larger text, creating a slight break, and then putting the message in smaller text, which is more reminiscent of Discord’s actual appearance. Then, we place a line break after each message so that they aren’t directly on top of each other, and then we end the <code>for</code> loop and block.</p>
<p>Here’s an image showing the <code>view</code> page with the message we sent earlier:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Image5.png" class="img-fluid figure-img"></p>
<figcaption>Image 5</figcaption>
</figure>
</div>
</section>
</section>
<section id="css" class="level1">
<h1>CSS</h1>
<p>If you were to run the website now, it would look incomplete–although all of the images and functionalities would be present, the website would look, unfortunately, as if it were made in 1995. We can make our site look a lot cleaner using a language called CSS (cascading style sheets) that will specify the visual elements. To do this, please revert to the folder with your Flask project, make a new folder called <code>static</code>, and inside, create a file called <code>style.css</code> using a text editor (recall that <code>base.html</code> refers to this file).</p>
<section id="css-syntax" class="level2">
<h2 class="anchored" data-anchor-id="css-syntax">CSS Syntax</h2>
<p>The syntax for CSS, at least in terms of what we’re using it for, is quite simple and follows a general pattern</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>tag {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>    aspect_1<span class="ch">:</span> <span class="dv">value_2</span><span class="op">;</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    aspect_2<span class="ch">:</span> <span class="dv">value_2</span><span class="op">;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    .</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    .</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    .</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>That is, we specify what specific tags that we want to modify in our document, and then we specify different characteristics (color, margin, etc.), a colon <code>:</code>, and then some sort of appropriate value, ended with a semicolon.</p>
<section id="html" class="level3">
<h3 class="anchored" data-anchor-id="html"><code>html</code></h3>
<p>The first aspect of our site for which we will specify anything is simply called <code>html</code> and is related to aspects of the <em>entire</em> <code>html</code> document. Here, we’ll control the font and the background color as such:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>html {</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">font-family</span><span class="ch">:</span> <span class="dv">Verdana</span><span class="op">;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">background</span><span class="ch">:</span> <span class="cn">#121b18</span><span class="op">;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can look up fonts online that are compatible–I went on this site (https://www.w3schools.com/css/css_font.asp) to see which ones were available without any modifications. I picked <code>Verdana</code> because it’s a sans-serif font.</p>
<p>We also change the background color via <code>background</code> with a hexadecimal color value. I took a screenshot of the Discord app and used an online color picker (https://imagecolorpicker.com/en) to grab the hex value of the background.</p>
</section>
<section id="text-specifications" class="level3">
<h3 class="anchored" data-anchor-id="text-specifications">Text specifications</h3>
<p>There are a few types of text tags that we use throughout our site. We’re going to change them one by one but largely apply the same ideas.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>html {</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">font-family</span><span class="ch">:</span> <span class="dv">Verdana</span><span class="op">;</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">background</span><span class="ch">:</span> <span class="cn">#121b18</span><span class="op">;</span></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>body {</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">color</span><span class="ch">:</span> <span class="cn">#81888e</span><span class="op">;</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">max-width</span><span class="ch">:</span> <span class="dv">900</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">margin-left</span><span class="ch">:</span> <span class="dv">350</span><span class="dt">px</span><span class="op">;</span></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>h4 {</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">color</span><span class="ch">:</span> <span class="cn">#89cff0</span><span class="op">;</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">margin</span><span class="ch">:</span> <span class="dv">1</span><span class="dt">rem</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">text-align</span><span class="ch">:</span> <span class="dv">left</span><span class="op">;</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>h1 {</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">color</span><span class="ch">:</span> <span class="cn">#81888e</span><span class="op">;</span></span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>    <span class="kw">margin</span><span class="ch">:</span> <span class="dv">1</span><span class="dt">rem</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">text-align</span><span class="ch">:</span> <span class="dv">left</span><span class="op">;</span></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-23"><a href="#cb18-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-24"><a href="#cb18-24" aria-hidden="true" tabindex="-1"></a>p {</span>
<span id="cb18-25"><a href="#cb18-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">color</span><span class="ch">:</span> <span class="cn">#ffffff</span><span class="op">;</span></span>
<span id="cb18-26"><a href="#cb18-26" aria-hidden="true" tabindex="-1"></a>    <span class="kw">margin</span><span class="ch">:</span> <span class="dv">1</span><span class="dt">rem</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb18-27"><a href="#cb18-27" aria-hidden="true" tabindex="-1"></a>    <span class="kw">text-align</span><span class="ch">:</span> <span class="dv">left</span><span class="op">;</span></span>
<span id="cb18-28"><a href="#cb18-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb18-29"><a href="#cb18-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-30"><a href="#cb18-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-31"><a href="#cb18-31" aria-hidden="true" tabindex="-1"></a>label {</span>
<span id="cb18-32"><a href="#cb18-32" aria-hidden="true" tabindex="-1"></a>    <span class="kw">color</span><span class="ch">:</span> <span class="cn">#81888e</span><span class="op">;</span></span>
<span id="cb18-33"><a href="#cb18-33" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The only parts that require a lot of explanation above are the <code>margin</code> attributes. These were largely copied from a CSS markup example that was given to us. Please visit the following website and the section on “Margin - Shorthand Property” for a detailed explanation https://www.w3schools.com/css/css_margin.asp – essentially, the first number refers to the amount of space given from the <em>top</em> and the second refers to the space from the <em>right</em>. <code>rem</code> is a unit that takes into account font sizes: <code>https://www.sitepoint.com/understanding-and-using-rem-units-in-css/</code></p>
<p>I set some of these settings to what they are because otherwise the page wouldn’t look right–it’s not common for a lot of trial and error to be necessary for this sort of process.</p>
</section>
<section id="other-specifications" class="level3">
<h3 class="anchored" data-anchor-id="other-specifications">Other Specifications</h3>
<p>There are a few other CSS settings that I’ve tweaked:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode css code-with-copy"><code class="sourceCode css"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>a {</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">color</span><span class="ch">:</span> <span class="cn">CornflowerBlue</span><span class="op">;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>nav ul  {</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span><span class="ch">:</span> <span class="dv">flex</span><span class="op">;</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">list-style</span><span class="ch">:</span> <span class="dv">none</span><span class="op">;</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">margin</span><span class="ch">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">padding</span><span class="ch">:</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>nav ul li a {</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    <span class="kw">display</span><span class="ch">:</span> <span class="dv">block</span><span class="op">;</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">padding</span><span class="ch">:</span> <span class="dv">1</span><span class="dt">rem</span><span class="op">;</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The template I got this from set the link (that is, <code>a</code>) color to cornflower blue, which I really like. We also specify the settings for the unordered list <code>&lt;ul&gt;</code> and the list item links <code>&lt;li&gt;</code> in <code>base.html</code>. The settings in <code>nav ul</code> I also took from the template that we had, but I like how they look– <code>display: none</code> makes it so that they’re side-by-side, <code>list-style: none</code> removes bullet points, and the <code>margin</code> and <code>padding</code> keep them adequately spaced. I discovered what these things do by seeing what happened to the website when I tweaked the settings.</p>
<p>Similarly, for <code>nav ul li a</code>, we use <code>block</code> for <code>display</code> to place some space between the <code>&lt;nav&gt;</code> and the body below, and we also use some padding.</p>
<p>Below we can see where each CSS element corresponds to on the webpages:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Image2.jpg" class="img-fluid figure-img"></p>
<figcaption>image 2</figcaption>
</figure>
</div>
</section>
</section>
</section>
<section id="thanks-for-reading-my-post-3" class="level1">
<h1>Thanks for reading my post :3</h1>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://pusheen.com/wp-content/uploads/2023/11/Capybar_Hot_Springs_GIF.gif" class="img-fluid figure-img"></p>
<figcaption>Pusheen in the Tub</figcaption>
</figure>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      return note.innerHTML;
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>